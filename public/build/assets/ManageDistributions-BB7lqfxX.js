import{r as v,s as M,B as U,c as r,f as F,e as i,b as e,w as q,g as f,h as $,F as A,z as E,t as u,v as _,d as b,j as D,o as z,m as V,n as T,p as I,T as N}from"./app-CLQc5iUQ.js";import{_ as B}from"./Sidebar-BuI_G_lZ.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={key:0,class:"fixed inset-0 bg-gray-400/40 backdrop-blur-sm flex items-center justify-center z-50"},P={class:"bg-white rounded-lg shadow-lg w-full max-w-xl p-6 relative z-50"},R=["value"],H={class:"grid grid-cols-2 gap-4"},O={class:"grid grid-cols-2 gap-4"},J={class:"flex justify-end space-x-3 pt-4"},K=["disabled"],Q={key:0,class:"ml-1 animate-pulse"},W={__name:"CreateDistributionModal",props:{visible:Boolean},emits:["close","created"],setup(C,{emit:w}){const h=C,p=w,o=v({survey_id:"",target_role:"student",date_field:"enroll_date",start_date:"",end_date:"",scheduled_active_date:"",scheduled_end_date:""}),x=v([]),c=v([]),S=M(()=>{const n=c.value.map(t=>t.survey_id);return x.value.filter(t=>!n.includes(t.id))}),k=async()=>{try{const[n,t]=await Promise.all([D.get("/surveys"),D.get("/survey-distributions")]);x.value=n.data,c.value=t.data}catch(n){console.error("Failed to fetch surveys/distributions:",n)}},y=v(!1),m=async()=>{y.value=!0;try{await D.post("/survey-distributions",{...o.value,is_active:!0}),alert("Survey distribution created successfully!"),p("created"),g()}catch(n){console.error("Failed to create distribution:",n),alert("Failed to create. Please try again.")}finally{y.value=!1}},g=()=>{p("close")};return U(()=>h.visible,n=>{n&&k()}),(n,t)=>C.visible?(i(),r("div",G,[e("div",P,[e("div",{class:"flex justify-between items-center mb-4"},[t[7]||(t[7]=e("h2",{class:"text-xl font-bold text-[#4072bc]"},"Schedule Survey Distribution",-1)),e("button",{onClick:g,class:"text-gray-500 hover:text-red-500 text-xl"},"Ã—")]),e("form",{onSubmit:q(m,["prevent"]),class:"space-y-4"},[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700"},"Select Survey",-1)),f(e("select",{"onUpdate:modelValue":t[0]||(t[0]=d=>o.value.survey_id=d),required:"",class:"w-full border px-3 py-2 rounded"},[t[8]||(t[8]=e("option",{disabled:"",value:""},"-- Select a survey --",-1)),(i(!0),r(A,null,E(S.value,d=>(i(),r("option",{key:d.id,value:d.id},u(d.title),9,R))),128))],512),[[$,o.value.survey_id]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700"},"Target Audience",-1)),f(e("select",{"onUpdate:modelValue":t[1]||(t[1]=d=>o.value.target_role=d),required:"",class:"w-full border px-3 py-2 rounded"},t[10]||(t[10]=[e("option",{value:"student"},"Student",-1),e("option",{value:"alumni"},"Alumni",-1)]),512),[[$,o.value.target_role]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700"},"Date Field",-1)),f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=d=>o.value.date_field=d),required:"",class:"w-full border px-3 py-2 rounded"},t[12]||(t[12]=[e("option",{value:"enroll_date"},"Enrolment Date",-1),e("option",{value:"expected_graduate_date"},"Graduation Date",-1)]),512),[[$,o.value.date_field]])]),e("div",H,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),f(e("input",{"onUpdate:modelValue":t[3]||(t[3]=d=>o.value.start_date=d),type:"date",class:"w-full border px-3 py-2 rounded",required:""},null,512),[[_,o.value.start_date]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700"},"End Date",-1)),f(e("input",{"onUpdate:modelValue":t[4]||(t[4]=d=>o.value.end_date=d),type:"date",class:"w-full border px-3 py-2 rounded",required:""},null,512),[[_,o.value.end_date]])])]),e("div",O,[e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700"},"Scheduled Active Date",-1)),f(e("input",{"onUpdate:modelValue":t[5]||(t[5]=d=>o.value.scheduled_active_date=d),type:"date",class:"w-full border px-3 py-2 rounded",required:""},null,512),[[_,o.value.scheduled_active_date]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700"},"Scheduled End Date",-1)),f(e("input",{"onUpdate:modelValue":t[6]||(t[6]=d=>o.value.scheduled_end_date=d),type:"date",class:"w-full border px-3 py-2 rounded",required:""},null,512),[[_,o.value.scheduled_end_date]])])]),e("div",J,[e("button",{type:"button",onClick:g,class:"px-4 py-2 rounded-full bg-gray-300 text-gray-800 font-semibold shadow-lg hover:brightness-110 transition"}," Cancel "),e("button",{type:"submit",disabled:y.value,class:"px-4 py-2 bg-gradient-to-r from-[#f07ba3] to-[#c4a8e3] hover:from-[#8475d2] hover:to-[#a7c8f8] text-white font-semibold rounded-full shadow-lg hover:brightness-110 transition flex items-center justify-center gap-1"},[t[18]||(t[18]=b(" Create")),y.value?(i(),r("span",Q,"...")):F("",!0)],8,K)])],32)])])):F("",!0)}},X={class:"relative"},Y={class:"flex ml-[20%] min-h-screen bg-gradient-to-tr from-[#f4f4f4] to-[#f9fbfd] relative z-0"},Z={class:"flex-1 flex justify-center p-10"},ee={class:"w-full max-w-7xl bg-white rounded-3xl shadow-2xl p-10 relative z-10"},te={class:"flex flex-col md:flex-row justify-between gap-4 mb-8"},le={class:"flex flex-wrap justify-center gap-2 md:gap-3"},se=["onClick"],ae={class:"flex justify-end"},oe={key:0,class:"text-center text-gray-600 text-lg animate-pulse"},de={key:1,class:"text-center text-gray-400 text-lg"},ne={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"},re={class:"text-xl font-bold text-[#4072bc] mb-2"},ie={class:"text-sm text-gray-500 mb-3"},ue={class:"absolute top-4 right-4"},ve={key:0,class:"px-3 py-1 text-yellow-700 bg-yellow-100 rounded-full text-xs font-semibold"},ce={key:1,class:"px-3 py-1 text-green-700 bg-green-100 rounded-full text-xs font-semibold"},fe={key:2,class:"px-3 py-1 text-red-700 bg-red-100 rounded-full text-xs font-semibold"},be=["onClick"],pe={key:0,class:"mt-4 text-sm text-gray-600 space-y-1"},me={__name:"ManageDistributions",setup(C){const w=v([]),h=v(!0),p=v(!1),o=v(null),x=v(""),c=v("All"),S=["All","Active","Inactive","Expired"],k=async()=>{try{const{data:a}=await D.get("/survey-distributions");w.value=a}catch(a){console.error("Failed to fetch distributions:",a),alert("Failed to load distributions")}finally{h.value=!1}},y=async()=>{p.value=!1,await k()},m=a=>{const s={year:"numeric",month:"short",day:"numeric"};return new Date(a).toLocaleDateString(void 0,s)},g=a=>a?a.charAt(0).toUpperCase()+a.slice(1):"",n=a=>{if(!a)return!1;const s=new Date,l=new Date(a);return s>l},t=a=>{o.value=o.value===a?null:a},d=M(()=>w.value.filter(a=>{const s=a.survey.title.toLowerCase().includes(x.value.toLowerCase());let l=!0;return c.value==="Active"&&(l=a.is_active&&!n(a.scheduled_end_date)),c.value==="Inactive"&&(l=!a.is_active&&!n(a.scheduled_end_date)),c.value==="Expired"&&(l=n(a.scheduled_end_date)),s&&l}));return z(()=>{k()}),(a,s)=>(i(),r("div",X,[e("div",Y,[V(B),e("main",Z,[e("div",ee,[s[10]||(s[10]=e("h1",{class:"text-4xl font-bold text-[#4072bc] mb-10 text-center"},"Manage Survey Distributions",-1)),e("div",te,[f(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=l=>x.value=l),placeholder:"Search by survey title...",class:"w-full md:w-1/3 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4072bc]"},null,512),[[_,x.value]]),e("div",le,[(i(),r(A,null,E(S,l=>e("button",{key:l,onClick:j=>c.value=l,class:T(["px-4 py-2 rounded-full font-semibold transition",c.value===l?"bg-[#4072bc] text-white":"bg-gray-200 text-gray-700"])},u(l),11,se)),64))]),e("div",ae,[e("button",{onClick:s[1]||(s[1]=l=>p.value=!0),class:"bg-gradient-to-r from-[#f07ba3] to-[#c4a8e3] hover:from-[#8475d2] hover:to-[#a7c8f8] text-white font-semibold px-7 py-3 rounded-full transition duration-300 shadow-md text-center"}," + Create New Distribution ")])]),h.value?(i(),r("div",oe," Loading distributions... ")):d.value.length?(i(),r("div",ne,[(i(!0),r(A,null,E(d.value,l=>(i(),r("div",{key:l.id,class:"bg-[#f9fbfd] p-8 rounded-2xl border border-[#e3e3e3] shadow relative"},[e("h2",re,u(l.survey.title),1),e("p",ie,[s[3]||(s[3]=b(" ðŸŽ¯ Target: ")),e("strong",null,u(g(l.target_role)),1),s[4]||(s[4]=e("br",null,null,-1)),b(" ðŸ“† Active: "+u(m(l.scheduled_active_date)),1)]),e("div",ue,[n(l.scheduled_end_date)?(i(),r("span",ve,"Expired")):l.is_active?(i(),r("span",ce,"Active")):(i(),r("span",fe,"Inactive"))]),e("button",{onClick:j=>t(l.id),class:"text-[#4072bc] font-semibold text-sm mt-2"},u(o.value===l.id?"Hide Details":"View Details"),9,be),V(N,{name:"fade-slide"},{default:I(()=>[o.value===l.id?(i(),r("div",pe,[e("div",null,[s[5]||(s[5]=e("b",null,"From:",-1)),b(" "+u(m(l.start_date)),1)]),e("div",null,[s[6]||(s[6]=e("b",null,"To:",-1)),b(" "+u(m(l.end_date)),1)]),e("div",null,[s[7]||(s[7]=e("b",null,"Date Field:",-1)),b(" "+u(l.date_field==="enroll_date"?"Enrolment Date":"Graduation Date"),1)]),e("div",null,[s[8]||(s[8]=e("b",null,"Schedule Ends:",-1)),b(" "+u(m(l.scheduled_end_date)),1)]),e("div",null,[s[9]||(s[9]=e("b",null,"Created:",-1)),b(" "+u(m(l.created_at)),1)])])):F("",!0)]),_:2},1024)]))),128))])):(i(),r("div",de," No survey distributions found. "))])])]),V(W,{visible:p.value,onClose:s[2]||(s[2]=l=>p.value=!1),onCreated:y},null,8,["visible"])]))}},_e=L(me,[["__scopeId","data-v-5dd69524"]]);export{_e as default};
